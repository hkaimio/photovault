<?xml version="1.0" encoding="UTF-8"?>
<!-- This is a sample metadata repository for the ObJectBridge System.
     Use this file as a template for building your own mappings-->

<!-- defining entities for include-files -->
<!DOCTYPE descriptor-repository SYSTEM "repository.dtd" [
<!ENTITY database SYSTEM "repository_database.xml">
<!ENTITY internal SYSTEM "repository_internal.xml">
]>


<descriptor-repository version="1.0" isolation-level="read-uncommitted">

    <!-- include all used database connections -->
    &database;

    <!-- include ojb internal mappings here -->
    &internal;

    <!-- include user defined mappings here -->

  <!-- PhotoFolder mappings -->

  <class-descriptor class="org.photovault.folder.PhotoFolder" table="photo_collections">

    <!-- one of (field-descriptor extent-class) -->
    <field-descriptor name="folderId" column="collection_id" jdbc-type="INTEGER" primarykey="true" autoincrement="true">
    </field-descriptor>
    <field-descriptor name="name" column="collection_name" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="description" column="COLLECTION_DESC" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="parentId" column="parent" jdbc-type="INTEGER">
    </field-descriptor>
    <reference-descriptor name="parent" class-ref="org.photovault.folder.PhotoFolder">
      <documentation>Parent of this folder</documentation>
      <foreignkey field-ref="parentId">
      </foreignkey>
    </reference-descriptor>
    <collection-descriptor name="subfolders" 
        element-class-ref="org.photovault.folder.PhotoFolder" 
        orderby="name" 
        sort="ASC" 
        auto-retrieve="true"
        auto-update="none"
        auto-delete="none"
        proxy="true">
      <inverse-foreignkey field-ref="parentId">
      </inverse-foreignkey>
    </collection-descriptor>
    <collection-descriptor name="photos" 
        element-class-ref="org.photovault.imginfo.PhotoInfo" 
        collection-class="org.apache.ojb.broker.util.collections.ManageableArrayList"
        indirection-table="collection_photos" 
        auto-retrieve="true"
        auto-update="none"
        auto-delete="none"        
        proxy="true">
      <fk-pointing-to-this-class column="collection_id">
      </fk-pointing-to-this-class>
      <fk-pointing-to-element-class column="photo_id">
      </fk-pointing-to-element-class>
    </collection-descriptor>
  </class-descriptor>

  <!-- ImageInstance mappings -->
  <class-descriptor class="org.photovault.imginfo.ImageInstance" table="image_instances" row-reader="org.photovault.imginfo.ImageInstanceRowReader">
    <field-descriptor name="volumeId" column="volume_id" jdbc-type="VARCHAR" primarykey="true" nullable="false">
      <documentation></documentation>
    </field-descriptor>
    <field-descriptor name="fname" column="fname" jdbc-type="VARCHAR" primarykey="true" nullable="false">
    </field-descriptor>
    <field-descriptor name="photoUid" column="photo_id" jdbc-type="INTEGER">
    </field-descriptor>
    <field-descriptor name="instanceType" column="instance_type" jdbc-type="VARCHAR" conversion="org.photovault.imginfo.OJBInstanceTypeConversion">
    </field-descriptor>
    <field-descriptor name="width" column="width" jdbc-type="INTEGER">
    </field-descriptor>
    <field-descriptor name="height" column="height" jdbc-type="INTEGER">
    </field-descriptor>
    <field-descriptor name="rotated" column="rotated" jdbc-type="FLOAT">
    </field-descriptor>
  </class-descriptor>

  <!-- PhotoInfo mappings -->
  <class-descriptor class="org.photovault.imginfo.PhotoInfo" table="photos">
    <field-descriptor name="uid" column="photo_id" jdbc-type="INTEGER" primarykey="true" autoincrement="true">
    </field-descriptor>
    <field-descriptor name="shootingPlace" column="shooting_place" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="photographer" column="photographer" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="FStop" column="f_stop" jdbc-type="FLOAT">
    </field-descriptor>
    <field-descriptor name="focalLength" column="focal_length" jdbc-type="FLOAT">
    </field-descriptor>
    <field-descriptor name="shootTime" column="shoot_time" jdbc-type="TIMESTAMP" conversion="org.photovault.imginfo.Timestamp2DateConversion">
    </field-descriptor>
    <field-descriptor name="timeAccuracy" column="time_accuracy" jdbc-type="DOUBLE">
    </field-descriptor>
    <field-descriptor name="shutterSpeed" column="shutter_speed" jdbc-type="DOUBLE">
    </field-descriptor>
    <field-descriptor name="camera" column="camera" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="lens" column="lens" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="film" column="film" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="filmSpeed" column="film_speed" jdbc-type="INTEGER">
    </field-descriptor>
    <field-descriptor name="prefRotation" column="pref_rotation" jdbc-type="DOUBLE">
    </field-descriptor>
    <field-descriptor name="description" column="description" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="techNotes" column="tech_notes" jdbc-type="VARCHAR">
    </field-descriptor>
    <field-descriptor name="quality" column="photo_quality" jdbc-type="INTEGER">
    </field-descriptor>
    <field-descriptor name="lastModified" column="last_modified" jdbc-type="TIMESTAMP"  conversion="org.photovault.imginfo.Timestamp2DateConversion">
    </field-descriptor>
    <field-descriptor name="origFname" column="orig_fname" jdbc-type="VARCHAR">
    </field-descriptor>

    <!-- instances collection 
    Instances are aggregates of PhotoInfo object so we can use the default 
    collection implementation which deleted objects that are deleted from the 
    collection
    -->
    <collection-descriptor name="instances" 
        element-class-ref="org.photovault.imginfo.ImageInstance"         
        auto-retrieve="true"
        auto-update="none"
        auto-delete="none">
      <inverse-foreignkey field-ref="photoUid">
      </inverse-foreignkey>
    </collection-descriptor>
    <!-- folders collection 
    This is an m:n mappin so we will use manageable collections.
    -->
    <collection-descriptor name="folders" 
        element-class-ref="org.photovault.folder.PhotoFolder" 
        indirection-table="collection_photos" 
        collection-class="org.apache.ojb.broker.util.collections.ManageableArrayList"
        auto-retrieve="true"
        auto-update="none"
        auto-delete="none"        
        proxy="true">
      <fk-pointing-to-this-class column="photo_id"/>
      <fk-pointing-to-element-class column="collection_id"/>
    </collection-descriptor>


  </class-descriptor>

</descriptor-repository>
